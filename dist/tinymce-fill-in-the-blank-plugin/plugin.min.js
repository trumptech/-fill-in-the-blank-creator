!function(){"use strict";var n=require("uuidjs");var l=function(t){var e=encodeURIComponent(t).match(/%[89ABab]/g);return 2*t.length+(e?e.length:0)},f=function(t,e){document.querySelector("iframe[src='"+t.url+"']").contentWindow.postMessage(e,t.origin)},g=function(o){for(var r=o.getDoc(),t=0,e=r.getElementsByClassName("fill-in-the-blank");t<e.length;t++)!function(t){var e=t.getAttribute("data-key"),n=t.getAttribute("data-answer"),i=t.getAttribute("data-scoreweight");t.onclick=function(t){t.stopPropagation(),r.getElementsByClassName("mce-offscreen-selection")[0].innerHTML="".concat(n," (").concat(i,")")},t.ondblclick=function(t){t.stopPropagation(),o.execCommand("answer-update-dialog",!0,{key:e,answer:n,scoreWeight:i})}}(e[t])};tinymce.PluginManager.add("fill-in-the-blank",function(a,t){var c=function(t){if(void 0===(t=t.settings.equation_editor_config))t={};else if("object"!=typeof t)throw new Error("'equation_editor_config' property must be an object");if(void 0===t.url)t.url="answer_editor/index.html";else if("string"!=typeof t.url)throw new Error("'url' property must be a string in equation_editor_config");if(void 0===t.origin)t.origin=document.location.origin;else if("string"!=typeof t.origin)throw new Error("'origin' property must be a string in equation_editor_config");if(void 0===t.title)t.title="Equation Editor";else if("string"!=typeof t.title)throw new Error("'title' property must be a string in equation_editor_config");if(void 0===t.space_after_content)t.space_after_content="&nbsp;";else if("string"!=typeof t.space_after_content)throw new Error("'space_after_content' property must be a string in equation_editor_config");if(void 0===t.btn_cancel_text)t.btn_cancel_text="Cancel";else if("string"!=typeof t.btn_cancel_text)throw new Error("'btn_cancel_text' property must be a string in equation_editor_config");if(void 0===t.btn_ok_text)t.btn_ok_text="Insert";else if("string"!=typeof t.btn_ok_text)throw new Error("'btn_ok_text' property must be a string in equation_editor_config");if("object"!=typeof t.mathlive_config&&void 0!==t.mathlive_config)throw new Error("'mathlive_config' property must be a object with config of mathlive, see http://docs.mathlive.io/tutorial-CONFIG.html");return t}(a),s=a.settings.fill_in_the_blank_update_callback;a.ui.registry.addButton("fill-in-the-blank",{text:"Add Blank",onAction:function(){var t=n.genV4().toString(),e=a.selection.getContent().replace(/<([^>]+)>|&nbsp;|\(|\)/gi,"");a.execCommand("answer-update-dialog",!0,{key:t,answer:e})}}),a.addCommand("answer-update-dialog",function(t,n){var i=n.key,o=(null==n?void 0:n.answer)||"",r=(null==n?void 0:n.scoreWeight)||0;a.windowManager.openUrl({url:c.url,title:c.title,width:820,height:400,buttons:[{type:"cancel",text:c.btn_cancel_text},{type:"custom",text:c.btn_ok_text,primary:!0}],onAction:function(){a.execCommand("fill-in-the-blank-insert",!0,{key:i,answer:o,scoreWeight:r}),a.windowManager.close()},onMessage:function(t,e){switch(e.mceAction){case"fill-in-the-blank-update":i=e.key,o=e.answer,r=e.scoreWeight;break;case"fill-in-the-blank-mounted":f(c,n)}}})}),a.addCommand("fill-in-the-blank-insert",function(t,e){for(var n="",i=e.answer.replace(/<([^>]+)>|&nbsp;|\(|\)/gi,""),o=0;o<Math.max(l(i),25);o++)n+="&nbsp;";var r='<span class="fill-in-the-blank" data-key="'.concat(e.key,'" data-answer="').concat(e.answer,'" data-scoreweight="').concat(e.scoreWeight,'" contentEditable="false"><span id="label"></span>&nbsp;<u>').concat(n,'</u>&nbsp;<span id="score"></span></span>');a.selection.setContent(r),g(a),s(e.key,e.answer,e.scoreWeight)}),a.on("focus",function(){g(a)})})}();