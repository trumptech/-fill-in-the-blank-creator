!function(){"use strict";var n=require("uuidjs");var l=function(e){var t=encodeURIComponent(e).match(/%[89ABab]/g);return 2*e.length+(t?t.length:0)},f=function(e,t){document.querySelector("iframe[src='"+e.url+"']").contentWindow.postMessage(t,e.origin)},g=function(o){for(var r=o.getDoc(),e=0,t=r.getElementsByClassName("fill-in-the-blank");e<t.length;e++)!function(e){var t=e.getAttribute("data-key"),n=e.getAttribute("data-answer"),i=e.getAttribute("data-scoreweight");e.onclick=function(e){e.stopPropagation(),r.getElementsByClassName("mce-offscreen-selection")[0].innerHTML="".concat(n," (").concat(i,")")},e.ondblclick=function(e){e.stopPropagation(),o.execCommand("answer-update-dialog",!0,{key:t,answer:n,scoreWeight:i})}}(t[e])};tinymce.PluginManager.add("fill-in-the-blank",function(a,e){var s=function(e){if(void 0===(e=e.settings.answer_editor_config))e={};else if("object"!=typeof e)throw new Error("'answer_editor_config' property must be an object");if(void 0===e.url)e.url="answer_editor/index.html";else if("string"!=typeof e.url)throw new Error("'url' property must be a string in answer_editor_config");if(void 0===e.origin)e.origin=document.location.origin;else if("string"!=typeof e.origin)throw new Error("'origin' property must be a string in answer_editor_config");if(void 0===e.title)e.title="Answer Editor";else if("string"!=typeof e.title)throw new Error("'title' property must be a string in answer_editor_config");if(void 0===e.space_after_content)e.space_after_content="&nbsp;";else if("string"!=typeof e.space_after_content)throw new Error("'space_after_content' property must be a string in answer_editor_config");if(void 0===e.btn_cancel_text)e.btn_cancel_text="Cancel";else if("string"!=typeof e.btn_cancel_text)throw new Error("'btn_cancel_text' property must be a string in answer_editor_config");if(void 0===e.btn_ok_text)e.btn_ok_text="Insert";else if("string"!=typeof e.btn_ok_text)throw new Error("'btn_ok_text' property must be a string in answer_editor_config");if("object"!=typeof e.mathlive_config&&void 0!==e.mathlive_config)throw new Error("'mathlive_config' property must be a object with config of mathlive, see http://docs.mathlive.io/tutorial-CONFIG.html");return e}(a),c=a.settings.fill_in_the_blank_update_callback;a.ui.registry.addButton("fill-in-the-blank",{text:"Add Blank",onAction:function(){var e=n.genV4().toString(),t=a.selection.getContent().replace(/<([^>]+)>|&nbsp;|\(|\)/gi,"");a.execCommand("answer-update-dialog",!0,{key:e,answer:t})}}),a.addCommand("answer-update-dialog",function(e,n){var i=n.key,o=(null==n?void 0:n.answer)||"",r=(null==n?void 0:n.scoreWeight)||0;a.windowManager.openUrl({url:s.url,title:s.title,width:820,height:400,buttons:[{type:"cancel",text:s.btn_cancel_text},{type:"custom",text:s.btn_ok_text,primary:!0}],onAction:function(){a.execCommand("fill-in-the-blank-insert",!0,{key:i,answer:o,scoreWeight:r}),a.windowManager.close()},onMessage:function(e,t){switch(t.mceAction){case"fill-in-the-blank-update":i=t.key,o=t.answer,r=t.scoreWeight;break;case"fill-in-the-blank-mounted":f(s,n)}}})}),a.addCommand("fill-in-the-blank-insert",function(e,t){for(var n="",i=t.answer.replace(/<([^>]+)>|&nbsp;|\(|\)/gi,""),o=0;o<Math.max(l(i),25);o++)n+="&nbsp;";var r='<span class="fill-in-the-blank" data-key="'.concat(t.key,'" data-answer="').concat(t.answer,'" data-scoreweight="').concat(t.scoreWeight,'" contentEditable="false"><span id="label"></span>&nbsp;<u>').concat(n,'</u>&nbsp;<span id="score"></span></span>');a.selection.setContent(r),g(a),c(t.key,t.answer,t.scoreWeight)}),a.on("focus",function(){g(a)})})}();